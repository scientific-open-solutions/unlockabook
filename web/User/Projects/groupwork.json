{
  "all_procs": {
    "procedure_1.csv": "item,code,max time,text,shuffle 1,flashcards_sheet,survey,\r\n0,survey,user,,off,,group_c_info.csv,\r\n0,instruct,user,You are about to be presented with some flashcards. You have 20 minutes to learn the content. Note that you and your partner will need to get at least 50% correct on flashcards with a red background.,off,,,\r\n0,flashcard,1200,,off,flashcards2.csv,,\r\n0,text,18000,Please come back in 5 or more hours (but leave this tab open!),off,,,\r\n0,instruct,user,You will now have 15 minutes to complete a test of the knowledge from the earlier flashcards. Please start when you're ready,off,,,\r\n0,survey,900,,off,,groupwork_test.csv,\r\n0,survey,user,,off,,placement_demographics.csv,",
    "procedure_2.csv": "item,code,max time,text,shuffle 1,flashcards_sheet,survey,\r\n0,survey,user,,off,,group_c_info.csv,\r\n0,instruct,user,You are about to be presented with some flashcards. You have 20 minutes to learn the content. Note that you and your partner will need to get at least 50% correct on flashcards with a red background.,off,,,\r\n0,flashcard,1200,,off,flashcards2.csv,,\r\n0,text,18000,Please come back in 5 or more hours (but leave this tab open!),off,,,\r\n0,instruct,user,You will now have 15 minutes to complete a test of the knowledge from the earlier flashcards. Please start when you're ready,off,,,\r\n0,survey,900,,off,,groupwork_test.csv,"
  },
  "conditions": "name,notes,stimuli,procedure,fullscreen,welcome,participant_id,end_message,start_message,buffer,scripts,\r\ncondition_1,You can put more detailed notes in this field,stimuli_1.csv,procedure_1.csv,off,,on,,,5,,\r\ncondition_2,You can put more detailed notes in this field,stimuli_1.csv,procedure_2.csv,off,,on,,,5,,",
  "all_stims": {
    "stimuli_1.csv": "cue,answer,font-size,image,image_front,image_back,competition,\r\nA,Apple,,,,,,\r\nB,Banana,,,,,,\r\n,,,,,,,",
    "flashcards1.csv": "cue,answer,font-size,image,image_front,image_back,competition,\r\nList 8 small molecule transmitters,\"Aminobutyric acid, glycine, glutamate, aspartate, histamine, acetylcholine, dopamine, norepinephrine, serotonin\",,,,,,\r\nGlycine,Glycine is the major inhibitory neurotransmitter in the brainstem and spinal chord.,,,,,yes,\r\nList 4 components of a neuron.,\"Axon, Cell body, Dendrites, Axon terminals\",,,,,,\r\nThe dopamine pathway,This neurotransmitter pathway projects through the prefrontal cortex,,,,,,\r\nWhat is GABA's role in the adult brain?,Set of projection neurons that synthesize and release the neurotransmitter dopamine,,,,,,\r\nlist 5 drugs that act on the nucleus accumbens,The main inhibitory neurotransmitter in the adult brain is GABA which reduce the activity of the neurons to which it binds.,,,,,yes,\r\n\"List 8 neuropeptide neurotransmitter examples \",\"Neurotensin, Somatostatin, Oxytocin, Vasopressin, Bradykinin, Dynorphin, Beta-endorphin, Corticotropin\",,,,,yes,\r\nNeuropeptide neurotransmitters and their role,\"Unlike small molecule neurotransmitters, neuropeptide neurotransmitters are encoded by specific genes and are synthesised from protein precursors in the cell body.\",,,,,,\r\nStages of a second stage reward neuron,\"Second stage reward neurons project from the ventral tegmental area to the Nucleus accumbens and use dopamine as their neurotransmitter, which is a small molecule neurotransmitter\",,,,,yes,\r\nNeurotransmitter synthesis and role,\" A substance is considered a neurotransmitter if it is synthesised in the neuron and is found in the pre synaptic terminus and is released to have an effect on the postsynaptic cell\",,,,,,\r\nNorepinephrine,\"Norepinephrine spreads anteriorly through the brain forming an extensive net in the cortex. It's roles include learning, memory, anxiety and psychosis.\",,,,,yes,\r\n,,,,,,,",
    "flashcards2.csv": "cue,answer,font-size,image,image_front,image_back,competition,\r\nList 8 small molecule transmitters,\"Aminobutyric acid, glycine, glutamate, aspartate, histamine, acetylcholine, dopamine, norepinephrine, serotonin\",,,,,yes,\r\nGlycine,Glycine is the major inhibitory neurotransmitter in the brainstem and spinal chord.,,,,,,\r\nList 4 components of a neuron.,\"Axon, Cell body, Dendrites, Axon terminals\",,,,,yes,\r\nThe dopamine pathway,This neurotransmitter pathway projects through the prefrontal cortex,,,,,yes,\r\nWhat is GABA's role in the adult brain?,Set of projection neurons that synthesize and release the neurotransmitter dopamine,,,,,yes,\r\nlist 5 drugs that act on the nucleus accumbens,The main inhibitory neurotransmitter in the adult brain is GABA which reduce the activity of the neurons to which it binds.,,,,,,\r\n\"List 8 neuropeptide neurotransmitter examples \",\"Neurotensin, Somatostatin, Oxytocin, Vasopressin, Bradykinin, Dynorphin, Beta-endorphin, Corticotropin\",,,,,,\r\nNeuropeptide neurotransmitters and their role,\"Unlike small molecule neurotransmitters, neuropeptide neurotransmitters are encoded by specific genes and are synthesised from protein precursors in the cell body.\",,,,,yes,\r\nStages of a second stage reward neuron,\"Second stage reward neurons project from the ventral tegmental area to the Nucleus accumbens and use dopamine as their neurotransmitter, which is a small molecule neurotransmitter\",,,,,,\r\nNeurotransmitter synthesis and role,\" A substance is considered a neurotransmitter if it is synthesised in the neuron and is found in the pre synaptic terminus and is released to have an effect on the postsynaptic cell\",,,,,yes,\r\nNorepinephrine,\"Norepinephrine spreads anteriorly through the brain forming an extensive net in the cortex. It's roles include learning, memory, anxiety and psychosis.\",,,,,,\r\n,,,,,,,"
  },
  "public_key": "fYLDlYnC4uOPKWH7Z2LpABpvcwAXhDOCckSNHfXW2C0=",
  "surveys": {
    "group_c_info.csv": [
      [
        "item_name",
        "text",
        "type",
        "answers",
        "values",
        "optional",
        ""
      ],
      [
        "Instructions1",
        "<h1>PARTICIPANT INFORMATION SHEET </h1>\n<h2>Title of Project: Group work Intervention</h2>\n<h3>Name of Lead Investigator:Dr. Anthony Haffey(University of Reading) </h3>\n \n<h3>Invitation paragraph </h3>\nYou have been invited to take part in a research study. Before you decide whether to take part it is important for you to understand why the research is being done and what it will involve. Please take time to read the following information carefully and discuss it with friends and relatives if you wish to. Ask us if there is anything that is not clear or if you would like more information. Take time to decide whether you wish to take part or not. Thank you for reading this. \n \n \n<h3>What is the study about? </h3>\nThe study will investigate the effect of group work on subsequent learning. \n \n \n<h3>What does the study involve? </h3>\nYou will be required to revise a set of flashcards (12) within a group setting. Following this, you will take a test on the content you have learnt from the screencast. This will consist of 12 multiple choice questions. Half of the questions (6) you will be required to get 50% of the questions correct to pass the test. However, on the other half of the questions (6) you will not need a specific percentage of correct answers to pass. \n \n \n<h3>Do I have to take part? </h3>\nIt is up to you to decide whether or not to take part. If you do decide to take part you will be given this information sheet to keep and be asked to sign a consent form. If you decide to take part you are still free to withdraw at any time during the data collection without giving a reason. \n \n \n<h3>I am interested in taking part, what do I do next? </h3>\nPlease find a quiet room with minimal distractions. Please ensure you have a good internet connection on a PC / laptop / tablet device. You will need 20 minutes to revise the flashcard in your group.There will then be a gap of 5 hours before completing an online test. You will have 15 minutes to complete the test. Once ready please follow the link to the online study. \n \n \n<h3>What if I agree to take part and then change my mind? </h3>\nThat is fine. You can contact the researchers if you would like to have any data of yours deleted.\n\n<h3>Will my taking part in this study be kept confidential? </h3>\nAll information which is collected about you during the course of the research will be kept on a password protected database and is strictly confidential. You will be given an ID code which will be used instead of your name. \n \n \n<h3>Who has reviewed the study? </h3>\nThis study has been reviewed and approved by the school ethics committee and has been given a favourable ethical opinion for conduct. \n \n \n<h3>How is data secured? </h3>\nNo personally identifiable information will be stored for this project. \n \n \nThis application has been reviewed by the University Research Ethics Committee and has been given a favourable ethical opinion for conduct <br>\n\nThank you, <br>\nProject Supervisor: Anthony Haffey <br>\n<i>Module convenor: Anthony Haffey (a.haffey@reading.ac.uk) </i>",
        "instruct",
        "",
        "",
        "",
        ""
      ],
      [
        "info_voluntary",
        "I understand that my participation in this study is voluntary and that I may withdraw any time without giving any reason.",
        "checkbox",
        "agree",
        "agree",
        "no"
      ],
      [
        "info_read_sheet",
        "I have read the information sheet about this study and the procedure of the study has been explained to me.",
        "checkbox",
        "agree",
        "agree",
        "no",
        null
      ],
      [
        "info_ask_question",
        "I have been given the opportunity to ask any questions that I may have about the study and these have been answered to my satisfaction.",
        "checkbox",
        "agree",
        "agree",
        "no",
        null
      ],
      [
        "info_understand",
        "I understand that the data collected from me in this study will be preserved and made available in anonymised form, so that they can be consulted and re-used by others.",
        "checkbox",
        "agree",
        "agree",
        "no",
        null
      ],
      [
        "info_first",
        "First name",
        "text",
        "",
        "",
        "no",
        null
      ],
      [
        "info_last",
        "Last name",
        "text",
        "",
        "",
        "no",
        null
      ],
      [
        null,
        null,
        null,
        null,
        null,
        null,
        null
      ]
    ],
    "groupwork_test.csv": [
      [
        "item_name",
        "text",
        "type",
        "answers",
        "values",
        "optional",
        "shuffle_question",
        "shuffle_answers",
        null
      ],
      [
        "b1",
        "1. Which of the following is not a small molecule transmitter?",
        "checkbox",
        "Histamine|somatostatin|glutamate|beta-endorphin",
        "",
        "No",
        "",
        "",
        null
      ],
      [
        "b2",
        "2. Which of the following is the major inhibitory neurotransmitter in the brainstem and spinal chord?",
        "radio",
        "Glycine|Aspartate|Dopamine|Enkephalin",
        "",
        "No",
        "",
        "",
        null
      ],
      [
        "b3",
        "3. Which of the following are not components of a neuron?",
        "checkbox",
        "Axon body|Axon|Cell body|Dendrite terminal",
        "",
        "No",
        "",
        "",
        null
      ],
      [
        "b4",
        "4. Unlike small molecule neurotransmitters, neuropeptide neurotransmitters are encoded by specific | and are synthesised from | in the |. An example of a neuropeptide neurotransmitter is |.",
        "jumbled",
        "genes|protein precursors|cell body|Oxytocin",
        "",
        "",
        "",
        "",
        null
      ],
      [
        "b5",
        "5. Cocaine addiction is related to which brain area?",
        "radio",
        "Nucleus Accumbens|Ventral Tegmental area|Frontal Cortex|Ventral pallidium",
        "",
        "No",
        "",
        "",
        null
      ],
      [
        "b6",
        "6. Which neurotransmitter pathway projects through the prefrontal cortex?",
        "radio",
        "The acetylcholine pathway|The dopamine pathway|The norepinephrine pathway|The serotonin pathway",
        "",
        "No",
        "",
        "",
        null
      ],
      [
        "b7",
        "7. Which of the following is the main inhibitory neurotransmitter in the adult brain?",
        "radio",
        "Glycine|GABA|serotonin|Acetylcholine",
        "",
        "No",
        "",
        "",
        null
      ],
      [
        "b8",
        "8. Which of the following drugs do not affect the nucleus accumbens?",
        "radio",
        "Amphetamines|Cocaine|Cannabis|Nicotine",
        "",
        "No",
        "",
        "",
        null
      ],
      [
        "b9",
        "9. Which of these is not an example of a neuropeptide neurotransmitter?",
        "checkbox",
        "Vasopressin|Dopamine|Serotonin|Corticotrophin releasing hormone",
        "",
        "No",
        "",
        "",
        null
      ],
      [
        "b10",
        "10. Second stage reward neurons project from the | to the | and use | as their neurotransmitter, which is a |",
        "jumbled",
        "Ventral tegmental area|nucleus accumbens|Dopamine|small molecule neurotransmitter",
        "",
        "",
        "",
        "",
        null
      ],
      [
        "b11",
        "11. Which of the following are roles of the norepinephrine pathway?",
        "checkbox",
        "Emotional processing|Learning|Anxiety|Motor control",
        "",
        "No",
        "",
        "",
        null
      ],
      [
        "b12",
        "12. A substance is considered a neurotransmitter if it is synthesised in the | and is found in the | and is released to have an effect on the |",
        "jumbled",
        "Neuron|pre synaptic terminus|post synaptic cell",
        "",
        "",
        "",
        "",
        null
      ],
      [
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null
      ]
    ],
    "placement_demographics.csv": [
      [
        "item_name",
        "text",
        "type",
        "answers",
        "optional",
        "values",
        "side_by_side",
        "btn_width",
        null
      ],
      [
        "Gender",
        "Gender",
        "likert",
        "Male|Female|Other",
        "No",
        "",
        "yes",
        "100px",
        null
      ],
      [
        "Age",
        "Age",
        "number",
        "",
        "No",
        "",
        "",
        "",
        null
      ],
      [
        "Education",
        "Education (which level are you currently in, or is the highest you've completed)",
        "dropdown",
        "Some high school| High school graduate| Some college, no degree| Associate's degree| Bachelor's degree|Graduate degree (Master's, Doctorate, etc.)",
        "No",
        "",
        "",
        "",
        null
      ],
      [
        "English_Fluency",
        "Do you speak English fluently?",
        "likert",
        "Yes|No",
        "No",
        "",
        "yes",
        "200px",
        null
      ],
      [
        "English_Age",
        "At what age did you start learning English? (write \"0\" if from birth)",
        "number",
        "",
        "No",
        "",
        "",
        "",
        null
      ],
      [
        "Country",
        "What is your country of residence?",
        "text",
        "",
        "No",
        "",
        "",
        "",
        null
      ],
      [
        "Handedness",
        "What is your preferred hand?",
        "likert",
        "Left|Right|Both",
        "No",
        "",
        "yes",
        "100px",
        null
      ],
      [
        "uor_student",
        "Are you a student at the University of Reading?",
        "likert",
        "Yes|No",
        "No",
        "",
        "yes",
        "200px"
      ],
      [
        "degree_subject",
        "What degree are you/have you complete(d)? Please write \"none\" if you have not been a university student.",
        "text",
        null,
        "No",
        null,
        null,
        null,
        null
      ],
      [
        "degree_year",
        "Can you please confirm how many years you have completed of a BSc degree. For example, if you are a second year student, you would write \"1\".",
        "text",
        null,
        "Yes",
        null,
        null,
        null,
        null
      ],
      [
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null,
        null
      ]
    ]
  },
  "code": {
    "instruct": "<!--\n/*  Collector (Garcia, Kornell, Kerr, Blake & Haffey)\n    A program for running experiments on the web\n    Copyright 2012-2016 Mikey Garcia & Nate Kornell\n\n\n    This program is free software: you can redistribute it and/or modify\n    it under the terms of the GNU General Public License version 3 as published by\n    the Free Software Foundation.\n\n    This program is distributed in the hope that it will be useful,\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n    GNU General Public License for more details.\n\n    You should have received a copy of the GNU General Public License\n    along with this program.  If not, see <http://www.gnu.org/licenses/>\n \t\t\n\t\tKitten/Cat release (2019-2021) author: Dr. Anthony Haffey (team@someopen.solutions)\t\t\n*/\n-->\n<style>\n#instruct_text{\n  margin:auto;\n  width:500px;\n  padding:50px;\n  max-height:600px;\n  text-align: center;  \n}\n#proceed_button{\n  position:absolute;\n  right: 20px;\n}\n#trial_contents{\n  position: absolute;\n  top:0;\n  bottom: 0;\n  left: 0;\n  right: 0;\n  margin:auto;\n  width:600;\n  height:600;\n}\n</style>\n<div id=\"trial_contents\">\n  <div id=\"instruct_text\">{{text}}</div>\n  <div>\n    <button class=\"btn btn-primary\" id=\"proceed_button\" onclick=\"Phase.submit()\">Proceed</button>\n  </div>\n</div>",
    "flashcard": "<!--\r\n  Flashcard trialtype\r\n  Authors:\r\n    Harry Sullivan\r\n    Dr. Anthony Haffey\r\n    University of Reading\r\n    \r\n---development---\r\n[\r\n  {\"text\":\"your practice text\"; }\r\n]\r\n---development---\r\n\r\n\r\n-->\r\n\r\n\r\n<style>\r\n.card_btn{\r\n  width:100%;\r\n  margin:1px;\r\n}\r\n\r\n.flashcard_box{\r\n  border: 2px solid teal;\r\n  width: 600px;\r\n  height: 400px;\r\n  text-align: center;\r\n  font-size: 25px;\r\n  border-radius: 15px;\r\n}\r\n\r\n#everything{\r\n  margin:auto;\r\n  width:800px;\r\n  padding:50px;\r\n  max-height:600px;\r\n  text-align: right;\r\n}\r\n#flashcard_image{\r\n  display:none;\r\n  width: 200px;\r\n  height:200px\r\n}\r\n#flashcard_text{\r\n  margin:5px;\r\n  padding:10px;\r\n}\r\n</style>\r\n\r\n<body>\r\n<div id=\"everything\">\r\n  <h5>Perception and Neuroscience Flashcards</h5>\r\n  <p class=\"text-right\">Select a flashcard from the panel on the left and use the buttons below to flip the card or hide it.</p>\r\n  <p class=\"text-right\">You will be alerted once 30 minutes have elapsed.</p>\r\n  <table id=\"card_table\">\r\n    <tr>\r\n      <td id=\"card_list\"></td>\r\n      <td>\r\n          <div class=\"flashcard_box\" id=\"box_0\">\r\n            <div id=\"flashcard_text\"></div>\r\n            <img id=\"flashcard_image\"/>\r\n          </div>\r\n      </td>\r\n    </tr>\r\n    <tr>\r\n      <td> </td>\r\n      <td>\r\n        <button type=\"button\" onclick=\"frontFlip()\" class=\"btn btn-primary\">Front</button>\r\n        <button type=\"button\" onclick=\"backFlip()\" class=\"btn btn-primary\">Back</button>\r\n      </div>\r\n    </td>\r\n  </table>\r\n</div>\r\n</body>\r\n\r\n<script>\r\n\r\nvar flashcards_sheet = \"{{flashcards_sheet}}\".toLowerCase();\r\n\r\nif(typeof(parent.parent.project_json.all_stims[flashcards_sheet]) !== \"undefined\"){\r\n  var cards_array = parent.parent.Collector.PapaParsed(\r\n    parent.parent.project_json.all_stims[flashcards_sheet]\r\n  );\r\n  \r\n  if(parent.parent.Project.is_exe){\r\n    var home_dir = parent.parent.Collector\r\n      .electron\r\n      .fs\r\n      .home_dir();\r\n    cards_array = cards_array.map(function(row){\r\n      row.image = row.image.replace(\"../User\", home_dir + \"/User\")\r\n      return row;\r\n    });\r\n  }\r\n  \r\n} else {\r\n  \r\n  cards_array = [\r\n    {\r\n      answer: \"Derived from the greek ‘synth’ (meaning together) and ethesia (sensation).<br>The joining of two senses, one sensory or cognitive pathway connects to another which results in involuntary experiences in another sensory or cognitive pathway↵60-100 different forms of synaesthesia have been identified (Simner, 2013)\",\r\n      cue: \"synaesthesia\",\r\n      \"font-size\": \"20px\"\r\n    },\r\n    {\r\n      answer: \"Ink colour is the same as the word written.<br>This test identifies if synaesthesia is automatic/pre-attentive. <br> Meier & Rothen (2009): This study was able to train non-synaesthetic individuals to behave like synaesthetes\",\r\n      cue: \"Modified stroop task\",\r\n      \"font-size\": \"20px\"\r\n    }\r\n  ]\r\n}\r\n\r\nvar current_card = 0; // this acts as a placeholder for the current flashcard\r\nvar no_of_cards = cards_array.length;\r\nvar cues = cards_array.map(function(card, index){\r\n  return \"<button onClick='loadCard(this.id)' class='btn btn-primary btn-sm card_btn' data-bs-toggle='button' autocomplete='off' id=\" + index + \">\" + card.cue + \"</button><br>\";\r\n});\r\n\r\n$(\"#card_list\").html(cues);\r\nfunction loadCard(clicked_id) {\r\n  current_card = clicked_id;\r\n  frontFlip();\r\n}\r\n\r\nfunction backFlip() {\r\n  $(\".flashcard_box\").css(\r\n    \"font-size\",\r\n    cards_array[current_card][\"font-size\"]\r\n  );\r\n  var this_card = cards_array[current_card][\"answer\"];\r\n  \r\n  if(cards_array[current_card].competition == \"yes\"){\r\n    $(\"#flashcard_text\").css(\"background-color\",\"red\");\r\n    $(\"#flashcard_text\").css(\"color\",\"white\");\r\n  } else {\r\n    $(\"#flashcard_text\").css(\"background-color\",\"white\");\r\n    $(\"#flashcard_text\").css(\"color\",\"black\");\r\n  }\r\n  \r\n  if(cards_array[current_card].image_back == \"yes\"){\r\n    $(\"#flashcard_image\").attr(\"src\", cards_array[current_card].image);\r\n    $(\"#flashcard_image\").show();\r\n  } else {\r\n    $(\"#flashcard_image\").hide();\r\n  }\r\n  $(\"#flashcard_text\").html(this_card);\r\n}\r\nfunction hideMe(){\r\n  $(\"#flashcard_text\").html(\"\")\r\n}\r\nfunction frontFlip(){\r\n  var this_card = cards_array[current_card][\"cue\"];\r\n  $(\".flashcard_box\").css(\"font-size\",\"25px\");\r\n  \r\n  if(cards_array[current_card].competition == \"yes\"){\r\n    $(\"#flashcard_text\").css(\"background-color\",\"red\");\r\n    $(\"#flashcard_text\").css(\"color\",\"white\");\r\n  } else {\r\n    $(\"#flashcard_text\").css(\"background-color\",\"white\");\r\n    $(\"#flashcard_text\").css(\"color\",\"black\");\r\n  }\r\n  \r\n  if(cards_array[current_card].image_front == \"yes\"){\r\n    $(\"#flashcard_image\").attr(\"src\", cards_array[current_card].image);\r\n    $(\"#flashcard_image\").show();\r\n  } else {\r\n    $(\"#flashcard_image\").hide();\r\n  }\r\n  \r\n  $(\"#flashcard_text\").html(this_card);\r\n}\r\n</script>\r\n",
    "survey": "<!--\r\n  Author: Dr. Anthony Haffey\r\n\r\n  Collector: Cat/Kitten/Cat release\r\n  A program for running experiments on the web\r\n  Copyright 2012-2018 Mikey Garcia & Nate Kornell\r\n\r\n  This program is free software: you can redistribute it and/or modify it under the terms of the GNU General Public License version 3 as published by the Free Software Foundation.\r\n\r\n  This program is distributed in the hope that it will be useful,\r\n  but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n  GNU General Public License for more details.\r\n\r\n  You should have received a copy of the GNU General Public License\r\n  along with this program.  If not, see <http://www.gnu.org/licenses/>\r\n\r\n  Kitten/Cat release (2019-2021) author: Dr. Anthony Haffey\r\n\r\n  (team@someopen.solutions)\r\n-->\r\n<style>\r\nbody{\r\n  background-color:#5F9EA0;\r\n  width:100%;\r\n  height:100%;\r\n}\r\ntd{\r\n  padding:10px;\r\n  vertical-align: top;\r\n}\r\n\r\n/*\r\n*\telements by id\r\n*/\r\n\r\n#content{\r\n  width:95%;\r\n}\r\n#proceed_button{\r\n  display:none;\r\n  float:right;\r\n}\r\n#survey_outline{\r\n\tposition: \t\t\t\t\tfixed;\r\n  top: \t\t\t\t\t\t\t\t50%;\r\n  left: \t\t\t\t\t\t\t50%;\r\n\theight: \t\t\t\t\t\t90%;\r\n\toverflow: \t\t\t\t\tauto;\r\n\t-webkit-transform: \ttranslate(-50%, -50%);\r\n  transform: \t\t\t\t\ttranslate(-50%, -50%);\r\n  background-color: \twhite;\r\n\tmin-width:        \t900px;\r\n\tmax-width:        \t9000px;\r\n\tborder-radius:    \t20px;\r\n  border-color:     \t#069;\r\n  border-style:     \tsolid;\r\n  border-width:     \t5px;\r\n\tpadding:            10px;\r\n}\r\n#survey_tabs{\r\n  padding:            20px;\r\n}\r\n#this_survey_id{\r\n  padding:            20px;\r\n  display:            none;\r\n}\r\n\r\n/*\r\n*\telements by class\r\n*/\r\n.feedback_span_multiple{\r\n  display: none;\r\n  margin:  10px;\r\n}\r\n.feedback_span_single{\r\n  display: none;\r\n  padding: 10px;\r\n}\r\n.likert_table td{\r\n  padding:    1px;\r\n  text-align: center;\r\n}\r\n.likert_table td:hover{\r\n  color: blue;\r\n}\r\n.score_total{\r\n  display: none;\r\n}\r\n.show_tab{\r\n  margin: 5px;\r\n}\r\n.survey_btn{\r\n\twhite-space: normal;\r\n\tword-wrap: \t initial;\r\n}\r\n.table_break{\r\n\twidth:    100%;\r\n\theight:   300px;\r\n\toverflow: auto;\r\n}\r\n\r\n\r\n/*\r\n* by Bora Alp Arat at https://stackoverflow.com/questions/21684101/css-vertical-scrollbar-padding-left-right-in-ul-possible\r\n*/\r\n::-webkit-scrollbar {\r\n  width: 14px;\r\n  height: 18px;\r\n}\r\n::-webkit-scrollbar-thumb {\r\n  height: 6px;\r\n  border: 4px solid rgba(0, 0, 0, 0);\r\n  background-clip: padding-box;\r\n\t-webkit-border-radius: 7px;\r\n  background-color: rgba(0, 102, 153, 0.5);\r\n  -webkit-box-shadow: inset -1px -1px 0px rgba(0, 0, 0, 0.05), inset 1px 1px 0px rgba(0, 0, 0, 0.05);\r\n}\r\n::-webkit-scrollbar-button {\r\n  width: 0;\r\n  height: 0;\r\n  display: none;\r\n}\r\n::-webkit-scrollbar-corner {\r\n  background-color: transparent;\r\n}\r\n</style>\r\n<div id=\"everything\">\r\n\t<div id=\"survey_outline\"></div>\r\n</div>\r\n<span id=\"scales_span\"></span>\r\n<script>\r\n/*\r\n* Retrieving settings\r\n*/\r\n\r\nif(typeof(settings) !== \"undefined\"){\r\n  settings = [settings];\r\n} else {\r\n  settings = {};\r\n}\r\n\r\n/*\r\n* vertical vs. horizontal tabs\r\n*/\r\n\r\nif(typeof(settings.tab_hor_vert) == \"undefined\" || settings.tab_hor_vert.toLowerCase() == \"horizontal\"){\r\n  settings.tab_hor_vert = \"horizontal\";\r\n  var please_wait = $(\"<div>\");\r\n  var this_survey = $(\"<div>\");\r\n  var survey_tabs = $(\"<div>\");\r\n  var proceed_btn = $(\"<input>\");\r\n  please_wait.attr(\"id\", \"please_wait_div\")\r\n             .html(\"Loading... Please wait\");\r\n  this_survey.addClass(\"needs-validation\")\r\n             .attr(\"id\", \"this_survey_id\")\r\n             .attr(\"novalidate\", true);\r\n  survey_tabs.attr(\"id\", \"survey_tabs\")\r\n             .addClass(\"border-top\")\r\n             .addClass(\"border-primary\")\r\n             .css(\"text-align\", \"right\")\r\n  proceed_btn.addClass(\"btn\")\r\n             .addClass(\"btn-primary\")\r\n             .attr(\"id\", \"proceed_button\")\r\n             .attr(\"type\", \"submit\")\r\n             .attr(\"value\", \"Proceed\")\r\n  $(\"#survey_outline\").append(please_wait)\r\n                      .append(this_survey)\r\n                      .append(survey_tabs)\r\n                      .append(proceed_btn);\r\n\r\n} else if (settings.tab_hor_vert.toLowerCase() == \"vertical\"){\r\n  $(\"#survey_outline\").html(\r\n    '<table>' +\r\n      '<tr>' +\r\n        '<td valign=\"top\" class=\"border-right border-primary\">'+\r\n          '<div id=\"survey_tabs\"></div>' +\r\n        '</td>' +\r\n        '<td>'+\r\n          '<div id=\"please_wait_div\">Please wait while survey is downloading</div>'+\r\n          '<div id=\"this_survey_id\" class=\"needs-validation\" novalidate></div>' +\r\n          '<input type=\"button\" value=\"Proceed\" class=\"btn btn-primary\" id=\"proceed_button\">'+\r\n        '</td>'+\r\n      '</tr>'+\r\n    '</table>'\r\n  );\r\n} else if(settings.tab_hor_vert.toLowerCase() == \"none\"){\r\n  $(\"#survey_outline\").html(\r\n    '<div id=\"survey_tabs\" style=\"display:none\"></div>' +\r\n    '<div id=\"please_wait_div\">Please wait while survey is downloading</div>'+\r\n    '<div id=\"this_survey_id\" class=\"needs-validation\" novalidate></div>'\r\n  );\r\n} else {\r\n  bootbox.alert(\"If you are the researcher, please check the 'settings for this survey. The input for 'tab_hor_vert' appears to be invalid. Please change it to 'horizontal' or 'vertical' or 'none' or remove 'tab_hot_vert' altogether from the settings, which will make the tabs invisible\");\r\n}\r\n\r\n/*\r\n* Defining objects\r\n*/\r\n\r\npage_break_management = {\r\n  breaks_remaining : 0,\r\n  breaks_index     : 0\r\n}\r\n\r\nproceed_object = {\r\n  type:[],\r\n  name:[],\r\n  break_no:[]\r\n};\r\n\r\nscoring_object={\r\n  scales:[],\r\n  scale_scores:[],\r\n  update_scales:function(this_survey){\r\n    headers = Object.keys(this_survey[0]);\r\n    this.scales = headers.filter(elm => elm.includes(\"score:\"));\r\n    var scales_html = '';\r\n    this.scales.forEach(function(element){\r\n      element = element.replace(\": \",\":\");\r\n      scales_html += \"<input name='\"+element.replace(/ |:/g,\"_\")+\"' class='score_total \"+element.replace(/ |:/g,\"_\")+\"' disabled>\";\r\n    });\r\n    $(\"#scales_span\").html(scales_html);\r\n  }\r\n}\r\n\r\nsurvey_obj = {};\r\n\r\n/*\r\n* Element actions\r\n*/\r\n\r\n/*\r\n$(function() {\r\n  $( \".datepicker\" ).datepicker({\r\n    dateFormat : 'mm/dd/yy',\r\n    changeMonth : true,\r\n    changeYear : true,\r\n    yearRange: '-100y:c+nn',\r\n    maxDate: '-1d'\r\n  });\r\n});\r\n*/\r\n\r\n\r\n$('#ExperimentContainer').css('transform','scale(1,1)');\r\n\r\n$(\"#proceed_button\").on(\"click\",function(){\r\n  var proceed = true;\r\n  var tabs    = document.getElementsByClassName('show_tab active');\r\n  if(tabs.length > 0){\r\n    var current_tab       = document.getElementsByClassName(\r\n      'show_tab active')[0]\r\n        .id\r\n        .replace(\"_button\", \"\")\r\n        .replace(\"tab_\",    \"\");\r\n    var response_elements = $('#table_'+current_tab).find('.response_element');\r\n\r\n  } else {\r\n    response_elements = $(\".table_break:visible\").find(\".response_element\");\r\n  }\r\n\r\n  for(var i = 0; i < response_elements.length; i++){\r\n    [row_no,item_name] = retrieve_row_no_item_name(response_elements[i]);\r\n    var this_optional = survey_obj.data[row_no].optional.toLowerCase();\r\n\r\n    if(this_optional.indexOf(\"no\") !== -1){\r\n      this_optional = this_optional.split(\"-\");       // find out whether there's a minimal number of responses\r\n      if(this_optional.length == 1){                  // default is that length needs to be at least 1\r\n        var min_resp_length = 1;\r\n      } else if(this_optional.length == 2) {\r\n        var min_resp_length = this_optional[1];\r\n      } else {\r\n        bootbox.alert(\"Error - you appear to have too many '-' characters in the 'optional' column\");\r\n        return false;\r\n      }\r\n    } else {\r\n      min_resp_length = 0;\r\n    }\r\n\r\n    var quest_resp = isJSON($(\"#\"+response_elements[i].id).val());\r\n    if (quest_resp.length < min_resp_length){\r\n      proceed = false;\r\n\t\t\t$(\"#\"+response_elements[i].id.replace(\"response\",\"question\")).removeClass(\"text-dark\");\r\n      $(\"#\"+response_elements[i].id.replace(\"response\",\"question\")).removeClass(\"text-success\");\r\n      $(\"#\"+response_elements[i].id.replace(\"response\",\"question\")).addClass(\"text-danger\");\r\n    } else {\r\n\t\t\t$(\"#\"+response_elements[i].id.replace(\"response\",\"question\")).removeClass(\"text-dark\");\r\n      $(\"#\"+response_elements[i].id.replace(\"response\",\"question\")).removeClass(\"text-danger\");\r\n      $(\"#\"+response_elements[i].id.replace(\"response\",\"question\")).addClass(\"text-success\");\r\n    }\r\n  }\r\n\r\n  if(current_tab == survey_obj.tabs && proceed){\r\n    if(typeof(sql_surveys) == \"undefined\"){\r\n      //$(\".table_break\");\r\n      var next_table_no = parseFloat($(\".table_break:visible\")[0].id.replace(\"table\",\"\")) + 1;\r\n\r\n      if($(\".table_break#table\"+next_table_no).length == 0){\r\n        if(typeof(Phase) !== \"undefined\"){\r\n          Phase.submit();\r\n        } else {\r\n          bootbox.alert(\"You've finished! Click on the preview button to restart.\")\r\n        }\r\n      } else {\r\n        $(\".table_break\").hide();\r\n        $(\".table_break#table\" + next_table_no).show();\r\n      }\r\n    } else {\r\n      $(\"#survey_outline\").html(\"<h1> You have finished the preview of this survey.</h1>\");\r\n    }\r\n  } else if(current_tab < survey_obj.tabs && proceed) {\r\n    current_tab ++;\r\n    $(\"#tab_\"+current_tab+\"_button\").removeClass(\"btn-secondary\");\r\n    $(\"#tab_\"+current_tab+\"_button\").removeClass(\"disabled\");\r\n    $(\"#tab_\"+current_tab+\"_button\").addClass(\"btn-outline-dark\");\r\n    $(\"#tab_\"+current_tab+\"_button\").click();\r\n  } else if(proceed == false){\r\n    bootbox.alert(\"You're missing some responses. Please fill in all the answers for the questions in red above.\");\r\n  } else if(current_tab > survey_obj.tabs){\r\n    bootbox.alert(\"Error - please contact Scientific Open Solutions about this problem, error 'Survey_001'.\");\r\n  }\r\n});\r\n\r\n//by qwerty at https://stackoverflow.com/questions/2116558/fastest-method-to-replace-all-instances-of-a-character-in-a-string\r\nString.prototype.replaceAll = function(str1, str2, ignore){\r\n  return this.replace(new RegExp(str1.replace(/([\\/\\,\\!\\\\\\^\\$\\{\\}\\[\\]\\(\\)\\.\\*\\+\\?\\|\\<\\>\\-\\&])/g,\"\\\\$&\"),(ignore?\"gi\":\"g\")),(typeof(str2)==\"string\")?str2.replace(/\\$/g,\"$$$$\"):str2);\r\n}\r\n\r\n\r\n/*\r\nFunctions\r\n*/\r\n\r\nfunction clean_item(this_item){\r\n  if(this_item.indexOf(\"'\") !== -1 |\r\n     this_item.indexOf('\"') !== -1){\r\n    bootbox.alert(\"Please avoid apostraphes or quote marks in the responses the participant can give. These cause problems with smooth running of surveys. This occurs when you wrote:<br><br>\" + this_item);\r\n  }\r\n  return(this_item);\r\n}\r\n\r\nfunction generate_feedback_string(feedback_array, this_index, feedback_color, row){\r\n  if(feedback_array){                 //i.e. if it's not null\r\n    if(feedback_array.length > 1){\r\n      return \"<div class='feedback_span_multiple \"+row[\"item_name\"].toLowerCase()+\"_feedback' style='color:\"+feedback_color[this_index]+\"'>\"+feedback_array[this_index]+\"</div>\";\r\n    } else {\r\n      return \"<div class='feedback_span_single \" +\r\n      row[\"item_name\"].toLowerCase() + \"_feedback' style='color:\" +\r\n      feedback_color[this_index] +\r\n      \"'>\" +\r\n      feedback_array[this_index] +\r\n      \"</div>\";\r\n    }\r\n  } else {\r\n    return \"\";\r\n  }\r\n}\r\n\r\nfunction get_feedback(row){\r\n  if(typeof(row[\"feedback\"]) !== \"undefined\" && row[\"feedback\"] !== \"\"){\r\n    feedback_array = row[\"feedback\"].split(\"|\");\r\n    if(typeof(row[\"feedback_color\"]) == \"undefined\"){\r\n      bootbox.alert(\"The color for the feedback options has not been set. If you created this questionnaire, please add a column 'feedback_color' to your survey and separate the colors by a pipe (|) character.\");\r\n    }\r\n    feedback_color = row[\"feedback_color\"].split(\"|\");\r\n  } else {\r\n    feedback_array = null;\r\n    feedback_color = '';\r\n  }\r\n  return [feedback_array,feedback_color];\r\n}\r\n\r\nfunction isJSON(str) {\r\n  try {\r\n    return JSON.parse(str);\r\n  } catch (e) {\r\n    return str;\r\n  }\r\n}\r\n\r\nfunction likert_update(this_element){\r\n\r\n  [row_no,item_name] = retrieve_row_no_item_name(this_element);\r\n\r\n  $(\".row_\"+row_no).removeClass(\"active\");\r\n  $(\".row_\"+row_no).removeClass(\"btn-primary\");\r\n  $(\".row_\"+row_no).addClass(\"btn-outline-primary\");\r\n  $(this_element).removeClass(\"btn-outline-primary\");\r\n  $(this_element).addClass(\"btn-primary\");\r\n  $(\"#survey_\"+item_name+\"_response\").val(this_element.value);\r\n  response_check(this_element);\r\n}\r\n\r\nfunction load_survey(survey){\r\n  /*\r\n  * are we in preview?\r\n  */\r\n  if(typeof(parent.collector_survey_preview) !== \"undefined\"){\r\n    survey_content = survey;\r\n  } else if(typeof(parent.master) !== \"undefined\" && parent.master.surveys.preview){\r\n    survey_content = survey;\r\n    survey_obj.mods = parent.master.mods;\r\n  } else {\r\n    survey = survey.toLowerCase().replace(\".csv\",\"\") + \".csv\";\r\n\r\n    if(typeof(parent.parent.project_json.surveys) !== \"undefined\" &&\r\n       typeof(parent.parent.project_json.surveys[survey]) !== \"undefined\"){\r\n      survey_content = parent.parent.project_json.surveys[survey];\r\n      survey_obj.mods = parent.parent.project_json.mods;\r\n\r\n    } else if(\r\n      typeof(parent.parent.project_json.surveys) !== \"undefined\" &&\r\n      typeof(parent.parent.project_json.surveys[\r\n        survey.replace(\".csv\",\"\")\r\n      ])\r\n    ){\r\n\t\t\tsurvey_content = parent.parent.project_json.surveys[survey.replace(\".csv\",\"\")];\r\n      survey_obj.mods = parent.parent.project_json.mods;\r\n\t\t}\telse {\r\n      bootbox.alert(\"Survey \" + survey  + \" doesn't appear to exist\");\r\n    }\r\n  }\r\n  process_returned_questionnaire(survey_content);\r\n}\r\n\r\nfunction process_question(row, row_no){\r\n  row.values = row.values == \"\" ? row.answers : row.values;\r\n  if(row_check(\"page_break\", row)){\r\n    page_break_management.breaks_remaining++;\r\n    question_td = \"</tr></table><table id='table\" +\r\n      page_break_management.breaks_remaining +\r\n      \"' style='display:none' class='table_break'></tr>\";\r\n  } else {\r\n    if(\r\n      typeof(row[\"values\"]) !== \"undefined\" & typeof(row[\"values\"]) !== \"function\"\r\n    ){ //to address microsoft edge issue.\r\n      value_array = row[\"values\"].split(\"|\");\r\n    } else {\r\n      value_array='';\r\n    }\r\n\r\n    if(row[\"item_name\"].indexOf(\" \") !== -1){\r\n      bootbox.alert(\"Please note that the 'item name' '\" +\r\n        row['item_name'] +\r\n        \"' is invalid because it has at least one space. Please use underscores instead of spaces. If you're not the creator of this task, please contact the person who created it.\"\r\n      );\r\n    }\r\n\r\n    /*\r\n    * class for scoring\r\n    */\r\n\r\n    var this_class = \"\";\r\n    for(var i=0;i<scoring_object.scales.length;i++){\r\n      if(row[scoring_object.scales[i].toLowerCase()]==\"1\"){\r\n        this_class += scoring_object.scales[i].toLowerCase().replace(\r\n          \"score: \",\"\"\r\n        ).replace(/ |-/,\"\") + \" \";\r\n      }\r\n      if(row[scoring_object.scales[i].toLowerCase()]==\"r1\"){\r\n        this_class += scoring_object.scales[i].toLowerCase().replace(\"score: \",\"\").replace(\" \",\"_\")+\"-r1 \";\r\n      }\r\n    }\r\n\r\n    /*\r\n    * adding to row to help with \"write\" function\r\n    */\r\n    var row_x = JSON.parse(\r\n      JSON.stringify(row)\r\n    );\r\n    row_x[\"row_no\"] = row_no;\r\n    row_x[\"this_class\"] = this_class;\r\n\r\n    [feedback_array,feedback_color] = get_feedback(row);\r\n\r\n\r\n    question_td = '<input type=\"hidden\" class=\"response_element row_' + row_no + '\" id=\"survey_' +\r\n      row[\"item_name\"].toLowerCase() +\r\n      '_response\" name=\"survey_' +\r\n      row[\"item_name\"].toLowerCase() +\r\n      '_response\" value=\"\">';\r\n\r\n    /*\r\n    * Survey settings\r\n    */\r\n    [row_ques_perc,row_resp_perc] = row_perc(row[\"question_width\"]);\r\n\r\n    if(typeof(settings.feedback_before_response) == \"undefined\"){\r\n      settings.feedback_before_response = true;\r\n    }\r\n\r\n    if(typeof(settings.lock_after_feedback) == \"undefined\"){\r\n      settings.lock_after_feedback = false;\r\n    }\r\n\r\n    if(typeof(row[\"type\"]) == \"undefined\"){\r\n      return false;\r\n    }\r\n\r\n    if(\r\n      typeof(survey_obj.mods) !== \"undefined\" &&\r\n\t\t\ttypeof(survey_obj.mods[row.type]) !== \"undefined\"\r\n    ){\r\n      var mod_html = survey_obj.mods[row.type].contents;\r\n\r\n      Object.keys(row).forEach(function(attribute){\r\n        mod_html = mod_html.replaceAll(\"{{\"+attribute+\"}}\",row[attribute]);\r\n      });\r\n      question_td += mod_html;\r\n    } else {\r\n      switch(row[\"type\"].toLowerCase()){\r\n        case \"page_start\":\r\n          var tabs_html = $(\"#survey_tabs\").html();\r\n          if(settings.tab_hor_vert == \"horizontal\"){\r\n            span_div = \"span\";\r\n          } else if(settings.tab_hor_vert == \"vertical\"){\r\n            span_div = \"div\";\r\n          }\r\n          if(typeof(survey_obj.tabs) == \"undefined\"){\r\n            survey_obj.tabs = 0;\r\n          } else {\r\n            survey_obj.tabs++;\r\n          }\r\n          if(survey_obj.tabs == 0){ //i.e. is the first tab\r\n            active_button = \"btn-outline-primary active\";\r\n          } else {\r\n            active_button = \"btn-secondary disabled\";\r\n          }\r\n          if(settings.tab_hor_vert == \"vertical\"){\r\n            var vert_btn_block = \"btn-block\";\r\n          } else {\r\n            var vert_btn_block = \"\";\r\n          }\r\n\r\n          tabs_html +=  '<'+span_div+' class=\"btn-group-toggle\" data-toggle=\"buttons\">'+\r\n            '<label id=\"tab_' + survey_obj.tabs + '_button\" class=\"btn show_tab '+active_button+' '+vert_btn_block+'\">'+\r\n              '<input type=\"checkbox\" checked autocomplete=\"off\">'+ row['text'] +\r\n            '</label>'+\r\n          '</'+span_div+'>';\r\n\r\n          $(\"#survey_tabs\").html(tabs_html);\r\n\r\n          page_break_indexes = [];\r\n          survey_obj.data.forEach(function(row,this_index){\r\n            if(typeof(row.type) !== \"undefined\" && row.type.toLowerCase() == \"page_start\"){\r\n              page_break_indexes.push(this_index);\r\n            }\r\n          });\r\n\r\n          if(survey_obj.tabs > 0){\r\n            question_td += \"</td><td></td></tr></table></div><div class='survey_page' id='tab_\" + survey_obj.tabs + \"' style='display:none'><table id='table_\" + survey_obj.tabs + \"' class='table_break'><tr>\";\r\n          } else {\r\n            question_td += \"</td><td></td></tr></table><div class='survey_page' id='tab_\"+survey_obj.tabs+\"' ><table id='table_\"+survey_obj.tabs+\"' class='table_break'><tr>\";\r\n          }\r\n          break;\r\n        case \"checkbox\":\r\n        case \"checkbox_vertical\":\r\n          question_td += write(\"checkbox_vertical\",row_x);\r\n          break;\r\n        case \"checkbox_horizontal\":\r\n          question_td += write(\"checkbox_horizontal\",row_x);\r\n          break;\r\n        case \"checkbox_single\":\r\n          question_td += write(\"checkbox_single\", row_x);\r\n          break;\r\n        case \"date\":\r\n          question_td += write(\"date\",row_x);\r\n        break;\r\n        case \"dropdown\":\r\n\t\t\t\tcase \"select\":\r\n          question_td += write(\"dropdown\",row_x);\r\n        break;\r\n        case \"email\":\r\n          question_td += write(\"email\", row_x);\r\n        break;\r\n        case \"google_slide\":\r\n        case \"jumbled\":\r\n        case \"instruct\":\r\n          // these are defined elsewhere to take the whole row\r\n          break;\r\n        case \"likert\":\r\n          question_td += write(\"likert\", row_x);\r\n        break;\r\n        case \"number\":\r\n          question_td += write(\"number\", row_x);\r\n          break;\r\n        case \"para\":\r\n          question_td += write(\"para\", row_x);\r\n          break;\r\n        case \"radio\":\r\n        case \"radio_vertical\":\r\n          question_td += write(\"radio_vertical\", row_x);\r\n          break;\r\n        case \"radio_horizontal\":\r\n          question_td += write(\"radio_horizontal\", row_x);\r\n        break;\r\n\r\n        case \"report_score\":\r\n            question_td += \"<input disabled class='form-control score_\" + row[\"item_name\"] + \" \"+row[\"item_name\"]+\"_item row_\"+row_no+\"' type='text' name='survey_\"+row['item_name'].toLowerCase()+\"'>\";\r\n        break;\r\n\r\n        case \"text\":\r\n          question_td += write(\"text\", row_x);\r\n        break;\r\n      }\r\n    }\r\n    if(feedback_array){\r\n        question_td += \"<button class='btn btn-outline-info feedback_btn \"+row[\"item_name\"]+\"_item row_\"+row_no+\"' data-toggle='tooltip' id='reveal_\"+row[\"item_name\"].toLowerCase()+\"_feedback' onclick='reveal_answers(this)'>Show</button>\";\r\n    }\r\n  }\r\n  if(typeof(row[\"type\"])== \"undefined\"){\r\n      return '';\r\n  } else {\r\n    if(row[\"type\"].toLowerCase() == \"instruct\"){\r\n      row_html  = write(\"instruct\",row);\r\n    } else if(row[\"type\"].toLowerCase() == \"jumbled\"){\r\n      //row_html  = question_td + write(\"jumbled\",row); <-- this is better, but being paused for placement work Anthony is doing\r\n      row_html  = write(\"jumbled\",row);\r\n\t\t} else if(row[\"type\"].toLowerCase() == \"likert\"){\r\n\r\n\t\t\tif(typeof(row[\"side_by_side\"]) !== \"undefined\" &&\r\n\t\t\t\t row[\"side_by_side\"].toLowerCase() == \"yes\"){\r\n\r\n\t\t\t\tvar row_html=\"<td class='text-primary' id='survey_\"+row[\"item_name\"].toLowerCase().replace(\" \",\"_\")+\"_question' style='width:\"+row_ques_perc+\"; text-align:right'>\"+row[\"text\"]+\"</td><td>\"+question_td+\"</label></td>\";\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tvar row_html = \"<tr>\" +\r\n\t\t\t\t\t\t\"<td colspan='2'>\" +\r\n\t\t\t\t\t\t\trow[\"text\"] +\r\n\t\t\t\t\t\t\"</td>\" +\r\n\t\t\t\t\t\"</tr>\" +\r\n\t\t\t\t\t\"<tr>\" +\r\n\t\t\t\t\t\t\"<td colspan='2' align='center'>\" +\r\n\t\t\t\t\t\t\tquestion_td +\r\n\t\t\t\t\t\t\"</td>\" +\r\n\t\t\t\t\t\"</tr>\";\r\n\t\t\t}\r\n\r\n\r\n    } else if(row[\"type\"].toLowerCase()==\"google_slide\") {\r\n      var row_html=\"<td colspan='2'>\"+row[\"text\"]+\"</label></td>\";\r\n    } else if(typeof(row[\"no_text\"]) !== \"undefined\" && row[\"no_text\"] == \"on\"){\r\n      var row_html=\"<td colspan='2'>\"+question_td+\"</td>\";\r\n    } else {\r\n      if(row['text'].toLowerCase() == \"page_start\" | row['type'].toLowerCase() == \"page_start\"){\r\n        row_html = question_td;\r\n      } else {\r\n        var row_html=\"<td class='text-primary' id='survey_\"+row[\"item_name\"].toLowerCase().replace(\" \",\"_\")+\"_question' style='width:\"+row_ques_perc+\"; text-align:right'>\"+row[\"text\"]+\"</td><td>\"+question_td+\"</label></td>\";\r\n      }\r\n    }\r\n    if(typeof(row[\"optional\"]) !== \"undefined\"){\r\n      if(row[\"optional\"].toLowerCase() == \"no\"){\r\n        proceed_object.name.push(row[\"item_name\"]);\r\n        proceed_object.type.push(row[\"type\"]);\r\n        proceed_object.break_no.push(page_break_management.breaks_remaining);\r\n      }\r\n    }\r\n    if(typeof(row[\"shuffle_question\"]) == \"undefined\" || row[\"shuffle_question\"].toLowerCase() == \"off\"){\r\n      this_shuffle='none';\r\n    } else {\r\n      this_shuffle=row[\"shuffle_question\"];\r\n    }\r\n    return [row_html,this_shuffle];\r\n  }\r\n}\r\n\r\nfunction process_score(row_no, values_col, this_response, item, values_reverse ){\r\n  item_values = survey_obj.data[row_no][values_col].split(\"|\");\r\n  if(typeof(values_reverse) !== \"undefined\" && values_reverse == \"r\"){\r\n    item_values.reverse();\r\n  }\r\n  item_answers      = survey_obj.data[row_no][\"answers\"].split(\"|\");\r\n  var this_value    = item_values[item_answers.indexOf(this_response)];\r\n  $(\"#survey_\" + item + \"_score\").val(this_value);\r\n  if(typeof(this_value) !== \"undefined\"){\r\n    return parseFloat(this_value);\r\n  }\r\n}\r\n\r\nfunction process_returned_questionnaire(data){\r\n  survey_obj.data = data;\r\n  survey_obj.data = Papa.parse(\r\n    Papa.unparse(survey_obj.data),{\r\n      header:true,\r\n      beforeFirstChunk: function(chunk) {\r\n        var rows = chunk.split( /\\r\\n|\\r|\\n/ );\r\n        var headings = rows[0].toLowerCase();\r\n        rows[0] = headings;\r\n        return rows.join(\"\\r\\n\");\r\n      },\r\n    }\r\n  ).data;\r\n  survey_obj.scales = {};\r\n  var col_headers = Object.keys(survey_obj.data[0]);\r\n  col_headers.forEach(function(header){\r\n    if(header.indexOf(\"score:\")==0){\r\n      var original_header = header;\r\n      header = header.replace(\"score: \",\"\");\r\n      header = header.replace(\"score:\",\"\");\r\n      survey_obj.scales[header] = {};\r\n      survey_obj.scales[header].questions = {};\r\n\r\n      for(var i = 1; i < survey_obj.data.length; i++){\r\n        row = survey_obj.data[i];\r\n        if(row[original_header] !== \"\" && typeof(row[original_header]) !== \"undefined\"){\r\n          survey_obj.scales[header].questions[i] = row[original_header];\r\n        }\r\n      }\r\n    }\r\n  });\r\n  write_survey(survey_obj.data,\"this_survey_id\");\r\n  $(\"#please_wait_div\").hide();\r\n  $(\"#proceed_button\").show();\r\n  $('html, body').animate({\r\n    scrollTop: $(\"#survey_outline\").offset().top\r\n  }, 1000);\r\n}\r\n\r\nfunction row_perc(this_rat){\r\n\tif(typeof(this_rat) == \"undefined\"){\r\n    row_resp_perc = \"50%\";\r\n    row_ques_perc = \"50%\";\r\n  } else {\r\n    row_resp_perc = parseFloat(100-this_rat.replace(\"%\",\"\"))+\"%\";\r\n    row_ques_perc = parseFloat(this_rat.replace(\"%\",\"\"))+\"%\";\r\n  }\r\n  return [row_ques_perc,row_resp_perc];\r\n}\r\n\r\nfunction response_check(submitted_element){\r\n  switch(submitted_element.type){\r\n    case \"checkbox\":\r\n\r\n      console.log(submitted_element);\r\n      console.log(submitted_element.name);\r\n\r\n\r\n\r\n      var checked_responses = $(\"[name='\"+submitted_element.name+\"']:checked\");\r\n      if(checked_responses.length){ //i.e. more than 0\r\n        var values = [];\r\n        for(var i = 0; i < checked_responses.length; i++){\r\n          values.push(checked_responses[i].value);\r\n        }\r\n        $(\"#\"+submitted_element.name+\"_response\").val(JSON.stringify(values));\r\n      } else {\r\n        $(\"#\"+submitted_element.name+\"_response\").val(\"\");\r\n      }\r\n      console.log($(\"#\"+submitted_element.name+\"_response\").val());\r\n      console.log($(\"#\"+submitted_element.name+\"_response\"));\r\n\r\n      break;\r\n\r\n      case \"button\":\r\n        $(\"#\" + submitted_element.name + \"_response\").val(\r\n          submitted_element.innerHTML\r\n        );\r\n      break;\r\n\r\n      case \"number\":\r\n      case \"radio\":\r\n      case \"select-one\":\r\n      case \"text\":\r\n      case \"textarea\":\r\n        $(\"#\" + submitted_element.name + \"_response\").val(\r\n          submitted_element.value\r\n        );\r\n      break;\r\n    }\r\n    update_score();\r\n}\r\n\r\nfunction retrieve_row_no_item_name(this_element){\r\n  var these_classes = this_element.className.split(\" \");\r\n  var row_no;\r\n  var item_name;\r\n  these_classes.forEach(function(this_class){\r\n    if (this_class.indexOf('row_') > -1) {\r\n      row_no = this_class.replace(\"row_\",\"\");\r\n    }\r\n    if (this_class.indexOf('_item') > -1) {\r\n      item_name = this_class.replace(\"_item\",\"\").toLowerCase();\r\n    }\r\n  });\r\n  return [row_no,item_name];\r\n}\r\n\r\nfunction reveal_answers(this_element){\r\n  var this_response = $(\"#\"+this_element.id.replace(\"reveal_\",\"survey_\").replace(\"_feedback\",\"_response\")).val();\r\n  response_present = this_response == \"\" ? false : true;\r\n\r\n  if(settings.feedback_before_response == false && response_present == false){\r\n    bootbox.alert(\"Please respond before trying reveal the feedback.\")\r\n  } else {\r\n    if($(\"#\"+this_element.id).hasClass(\"btn-outline-info\")){\r\n      $(\".\"+this_element.id.replace(\"reveal_\",\"\")).show(500);\r\n      if(settings.lock_after_feedback){\r\n        var item_class = this_element.id.replace(\"_feedback\",\"_item\").replace(\"reveal_\",\"\");\r\n        $(\".\"+item_class).prop(\"disabled\",true);\r\n        document.getElementsByClassName(item_class).title = \"The person creating this content has set it so that your answers are locked in once you have chosen to see the feedback\";\r\n        $(\"#\"+this_element.id).addClass(\"btn-info\");\r\n        $(\"#\"+this_element.id).removeClass(\"btn-outline-info\");\r\n        $(\"#\"+this_element.id).html(\"Locked\");\r\n        document.getElementById(this_element.id).title = 'The person creating this content has set it so that your answers are locked in once you have chosen to see the feedback';\r\n        $(\"#\"+this_element.id).addClass(\"disabled\");\r\n      } else {\r\n        $(\"#\"+this_element.id).html(\"Hide\");\r\n        $(\"#\"+this_element.id).removeClass(\"btn-outline-info\");\r\n        $(\"#\"+this_element.id).addClass(\"btn-info\");\r\n      }\r\n    } else {\r\n      $(\"#\"+this_element.id).html(\"Show\");\r\n      $(\".\"+this_element.id.replace(\"reveal_\",\"\")).hide(500);\r\n      $(\"#\"+this_element.id).addClass(\"btn-outline-info\");\r\n      $(\"#\"+this_element.id).removeClass(\"btn-info\");\r\n    }\r\n  }\r\n}\r\n\r\nfunction row_check(type, row){\r\n  if(type = \"page_break\"){\r\n    return (\r\n      typeof(row[\"text\"]) !== \"undefined\" &&\r\n\t\t  typeof(row[\"type\"]) !== \"undefined\" &&\r\n\t\t  row['text'].toLowerCase() == \"page_break\" |\r\n      row['type'].toLowerCase() == \"page_break\"\r\n    )\r\n\r\n  } else if(type=\"\"){\r\n\r\n  }\r\n}\r\n\r\n// http://stackoverflow.com/questions/962802#962890\r\nfunction shuffle(array) {\r\n  var tmp, current, top = array.length;\r\n  if(top) while(--top) {\r\n    current = Math.floor(Math.random() * (top + 1));\r\n    tmp = array[current];\r\n    array[current] = array[top];\r\n    array[top] = tmp;\r\n  }\r\n  return array;\r\n}\r\n\r\nfunction shuffle_answers(row){\r\n  if(\r\n    typeof(row[\"shuffle_answers\"]) !== \"undefined\" &&\r\n    row[\"shuffle_answers\"].toLowerCase() == \"yes\"\r\n  ){\r\n    var answers = row[\"answers\"].split(\"|\");\r\n    order = shuffle([...Array(answers.length).keys()]);\r\n\r\n    var ordered_answers = order.map(function(position){\r\n      return answers[position];\r\n    });\r\n    row[\"answers\"] = ordered_answers.join(\"|\");\r\n\r\n    if(row[\"values\"].indexOf(\"|\") !== -1){\r\n      var values = row[\"values\"].split(\"|\");\r\n      var ordered_values = order.map(function(position){\r\n        return values[position];\r\n      });\r\n      row[\"values\"] = ordered_values.join(\"|\");\r\n    }\r\n  }\r\n  return row;\r\n}\r\n\r\nfunction update_score(){\r\n  var scales = Object.keys(survey_obj.scales);\r\n  scales.forEach(function(scale){\r\n    this_scale = survey_obj.scales[scale];\r\n    var questions = Object.keys(this_scale.questions);\r\n    var this_score = 0;\r\n    complete_score = true;\r\n\r\n    questions.forEach(function(row_no){\r\n      var item = survey_obj.data[row_no].item_name.toLowerCase();\r\n      var this_response = $(\"#survey_\"+item+\"_response\").val(); //response\r\n      var normal_reverse = this_scale.questions[row_no];\r\n\r\n      if(normal_reverse.indexOf(\"-\") == -1){\r\n        var multiplier = parseFloat(normal_reverse.replace(\"r\",\"\"));\r\n        if(normal_reverse.indexOf(\"r\") == 0){ //reverse the values\r\n          this_value = process_score(row_no,\"values\",this_response,item,\"r\");\r\n        } else {\r\n          this_value = process_score(row_no,\"values\",this_response,item);\r\n        }\r\n      } else {\r\n        values_reverse = normal_reverse.split(\"-\");\r\n        values_col     = values_reverse[0].toLowerCase();\r\n        normal_reverse = values_reverse[1];\r\n        var multiplier = parseFloat(normal_reverse.replace(\"r\",\"\"));\r\n\r\n        if(normal_reverse.indexOf(\"r\") == 0){ //reverse the values\r\n          this_value = process_score(row_no,values_col,this_response,item,\"r\");\r\n        } else {\r\n          this_value = process_score(row_no,values_col,this_response,item);\r\n        }\r\n      }\r\n      if(typeof(this_value) !== \"undefined\"){\r\n        this_score += multiplier * this_value;\r\n      } else {\r\n        complete_score = false;\r\n      }\r\n    });\r\n    if(complete_score){\r\n      $(\".score_\"+scale).addClass(\"bg-success\");\r\n      $(\".score_\"+scale).removeClass(\"bg-danger\");\r\n      $(\".score_\"+scale).addClass(\"text-light\");\r\n      document.getElementsByClassName(\"score_\"+scale).title = 'All relevant questions have been answered';\r\n    } else {\r\n      $(\".score_\"+scale).removeClass(\"text-success\");\r\n      $(\".score_\"+scale).addClass(\"bg-danger\");\r\n      $(\".score_\"+scale).addClass(\"text-light\");\r\n      document.getElementsByClassName(\"score_\"+scale).title = 'At least one relevant questions has NOT been answered';\r\n    }\r\n    $(\".score_\"+scale).val(this_score);\r\n  });\r\n}\r\n\r\nfunction write(type, row){\r\n  var this_html = \"\";\r\n  [feedback_array, feedback_color] = get_feedback(row);\r\n  row = shuffle_answers(row);\r\n  row[\"item_name\"] = row[\"item_name\"].toLowerCase();\r\n\r\n  if(type == \"checkbox_horizontal\"){\r\n    var options = row[\"answers\"].split(\"|\");\r\n    var this_table = $(\"<table>\");\r\n        this_row = this_table[0].insertRow()\r\n    for(var i=0; i<options.length;i++){\r\n      var this_cell = this_row.insertCell();\r\n      var this_div = $(\"<div>\");\r\n          this_div.addClass(\"custom-control\");\r\n          this_div.addClass(\"custom-checkbox\");\r\n      var this_input = $(\"<input>\");\r\n          this_input[0].type = \"checkbox\";\r\n          this_input[0].id = row[\"item_name\"] + i;\r\n          this_input[0].name = 'survey_' + row[\"item_name\"];\r\n          this_input.addClass(\"custom-control-input\")\r\n            .addClass(\"response\")\r\n            .addClass(row[\"this_class\"])\r\n            .addClass(row[\"custom-control\"])\r\n            .addClass(row[\"custom-checkbox\"])\r\n            .addClass(row[\"item_name\"] +'_item')\r\n            .addClass('row_' + row[\"row_no\"]);\r\n      var this_label = $(\"<label>\");\r\n          this_label[0].htmlFor = row[\"item_name\"] + i;\r\n          this_label[0].innerText = options[i];\r\n          this_label.addClass(\"custom-control-label\");\r\n      this_div.append(this_input)\r\n              .append(this_label);\r\n      this_cell.innerHTML = this_div[0].outerHTML;\r\n    }\r\n    this_html += this_table[0].outerHTML;\r\n\r\n  } else if(type == \"checkbox_single\"){\r\n\r\n    var this_div = $(\"<div>\");\r\n        this_div.attr(\"data-toggle\", \"buttons\");\r\n        this_div.addClass(\"btn-group-toggle\");\r\n    var this_label = $(\"<label>\");\r\n        this_label.addClass(\"btn\");\r\n        this_label.addClass(\"btn-outline-primary\");\r\n        this_label.html(row[\"answers\"]);\r\n    var this_checkbox = $(\"<input>\");\r\n        this_checkbox[0].id = row[\"item_name\"];\r\n        this_checkbox[0].name = \"survey_\" +\r\n          row[\"item_name\"].toLowerCase();\r\n        this_checkbox[0].type = \"checkbox\";\r\n        this_checkbox.attr(\"checked\",true);\r\n        this_checkbox\r\n          .addClass(\"response\")\r\n          .addClass(\r\n            row[\"item_name\"] +\r\n            '_item row_' +\r\n            row[\"row_no\"]\r\n          );\r\n    this_div.append(this_label);\r\n    this_label.append(this_checkbox)\r\n    this_html += this_div[0].outerHTML;\r\n\r\n  } else if(type == \"checkbox_vertical\"){\r\n    var options = row[\"answers\"].split(\"|\");\r\n    var values  = row[\"values\"].split(\"|\");\r\n    for(var i = 0; i < options.length; i++){\r\n      feedback_string = generate_feedback_string(\r\n        feedback_array, i, feedback_color, row\r\n      );\r\n      var this_div = $(\"<div>\");\r\n          this_div\r\n            .addClass(\"custom-control\")\r\n            .addClass(\"custom-checkbox\");\r\n      var this_checkbox = $(\"<input>\");\r\n          this_checkbox[0].id= row[\"item_name\"]+ i;\r\n          this_checkbox[0].value = options[i];\r\n          this_checkbox[0].type = \"checkbox\";\r\n          this_checkbox[0].name = 'survey_'+\r\n            row[\"item_name\"].toLowerCase();\r\n          this_checkbox\r\n            .addClass(\"custom-control-input\")\r\n            .addClass(row[\"this_class\"])\r\n            .addClass(\"custom-control\")\r\n            .addClass(\"custom-checkbox\")\r\n            .addClass(\"response\")\r\n            .addClass(row[\"item_name\"] + \"_item_row\");\r\n      var this_label = $(\"<label>\");\r\n          this_label[0].htmlFor = row[\"item_name\"] + i;\r\n          this_label[0].innerHTML = options[i];\r\n          this_label.addClass(\"custom-control-label\");\r\n      this_div.append(this_checkbox)\r\n              .append(this_label);\r\n\r\n      this_html += this_div[0].outerHTML;\r\n    }\r\n\r\n  } else if(type == \"date\"){\r\n    var input = $(\"<input>\");\r\n        input.addClass(\"response\")\r\n             .addClass(\"custom-control\")\r\n             .addClass(\"datepicker\")\r\n             .addClass(\"date\")\r\n             .addClass(row[\"item_name\"] + \"_item\")\r\n             .addClass(\"row_\" + row[\"row_no\"])\r\n             .attr(\"name\", \"survey_\" + row['item_name'])\r\n             .attr(\"type\", \"text\");\r\n\r\n  } else if(type == \"dropdown\"){\r\n    var options = row[\"answers\"].split(\"|\");\r\n    var this_dropdown = $(\"<select>\");\r\n        this_dropdown.addClass(\"form-control\")\r\n          .addClass(\"response\")\r\n          .addClass(\"txt-primary\")\r\n          .addClass(row[\"item_name\"] + \"_item\")\r\n          .addClass(\"row_\" + row[\"row_no\"])\r\n          .addClass(\"collector_button\")\r\n          .attr(\"name\", \"survey_\" + row[\"item_name\"])\r\n          .css(\"margin\", \"0px\")\r\n          .css(\"width\", \"auto\");\r\n\r\n    /* this will be necessary to tidy up jumbled sentences\r\n    if(typeof(row[\"item_name_old\"]) !== \"undefined\"){\r\n      this_dropdown.addClass(row[\"item_name_old\"] + \"_item\");\r\n    }\r\n    */\r\n\r\n    this_dropdown.append(\"<option selected disabled hidden>-- no option selected --</option>\");\r\n    options.forEach(function(this_option){\r\n      this_dropdown.append(\r\n        \"<option>\" + this_option + \"</option>\"\r\n      );\r\n    });\r\n    var this_html = this_dropdown[0].outerHTML;\r\n\r\n  } else if(type == \"email\"){\r\n    var this_input = $(\"<input>\");\r\n        this_input\r\n          .addClass(\"form-control\")\r\n          .addClass(\"response\")\r\n          .addClass(row[\"item_name\"] + \"_item row_\" + row[\"row_no\"])\r\n          .attr(\"type\", \"email\")\r\n          .attr(\"name\", 'survey_' + row['item_name']);\r\n\r\n  } else if(type == \"instruct\"){\r\n    this_html += \"<td colspan='2'>\" + row[\"text\"] + \"</td>\";\r\n  } else if(type == \"jumbled\"){\r\n    var this_td = $(\"<td>\");\r\n        this_td.attr(\"colspan\",2) ;\r\n\r\n    var this_div = $(\"<div>\");\r\n        this_div.addClass(\"form-inline\")\r\n                .addClass(\"bg-secondary\")\r\n                .addClass(\"text-white\")\r\n                .css(\"width\", \"100%\")\r\n                .css(\"padding\", \"20px\")\r\n                .css(\"margin\", \"20px\")\r\n                .css(\"border-radius\", \"5px\");\r\n\r\n    var question = row[\"text\"].split(\"|\");\r\n    questions_html = question.map(function(text,index){\r\n      if(index == question.length - 1){\r\n        return text;\r\n      } else {\r\n        var row_x = row;\r\n        row_x[\"item_name_old\"] = row_x[\"item_name\"];\r\n        row_x[\"item_name\"]     = row_x[\"item_name\"] + \"_\" + index;\r\n        var row_html = text + write(\"dropdown\", row_x)\r\n          .replace(\"margin: 0px\",\"margin: 5px\");\r\n        row_x[\"item_name\"] = row_x[\"item_name_old\"];\r\n        return row_html;\r\n      }\r\n    }).join(\"\");\r\n\r\n    this_td.append(this_div);\r\n    this_div.append(questions_html);\r\n\r\n    this_html = this_td[0].outerHTML;\r\n\r\n  } else if(type == \"likert\"){\r\n    // set styles\r\n    if(typeof(row[\"btn_width\"]) == \"undefined\"){\r\n      row[\"btn_width\"] = \"auto\"\r\n    }\r\n    if(typeof(row[\"side_width\"]) == \"undefined\"){\r\n      var side_width = \"auto\";\r\n    }\r\n\r\n    // create and build these elements\r\n    var this_div = $(\"<div>\");\r\n    if(typeof(row[\"side_text\"]) !== \"undefined\" &&\r\n      row[\"side_text\"] !== \"\"\r\n    ){\r\n      side_text = row[\"side_text\"].split(\"|\");\r\n      side_text = side_text.map(function(this_side){\r\n        var this_span = $(\"<span>\");\r\n            this_span.css(\"width\", side_width)\r\n                     .css(\"padding\", \"20px\")\r\n                     .addClass(\"text-primary\")\r\n                     .html(\"<b>\" + this_side + \"</b>\");\r\n        return this_span[0].outerHTML;\r\n      });\r\n    } else {\r\n      side_text = [\"\",\"\"];\r\n    }\r\n\r\n    this_div\r\n      .addClass(\"btn-group\")\r\n      .addClass(\"btn-group-toggle\")\r\n      .append(side_text[0])\r\n      .attr(\"data-togle\",\"buttons\");\r\n\r\n    var options = row[\"answers\"].split(\"|\");\r\n    var values  = row[\"values\"].split(\"|\");\r\n    for(var i=0; i<options.length;i++){\r\n      var this_button = $(\"<button>\");\r\n          this_button\r\n            .attr(\"autocomplete\", \"off\")\r\n            .attr(\"id\", 'likert_' + row[\"row_no\"] + '_' + i)\r\n            .attr(\"onclick\",'likert_update(this)')\r\n            .attr(\"value\", values[i])\r\n            .addClass(\"btn\")\r\n            .addClass(\"btn-outline-primary\")\r\n            .addClass(\"survey_btn\")\r\n            .addClass(\r\n              row[\"item_name\"] + '_item row_' + row[\"row_no\"]\r\n            )\r\n            .css(\"width\", row[\"btn_width\"])\r\n            .html(clean_item(options[i]));\r\n      this_div.append(this_button);\r\n    }\r\n    this_div.append(side_text[1]);\r\n    this_html += this_div[0].outerHTML;\r\n\r\n  } else if(type == \"number\"){\r\n    var this_input = $(\"<input>\");\r\n        this_input[0].type = \"number\";\r\n        this_input[0].name = 'survey_' + row['item_name'];\r\n        this_input\r\n          .addClass(\"response\")\r\n          .addClass(\"form-control\")\r\n          .addClass(row[\"item_name\"] + \"_item row_\" + row[\"row_no\"]);\r\n    this_html += this_input[0].outerHTML;\r\n\r\n  } else if(type == \"para\"){\r\n    var this_textarea = $(\"<textarea>\");\r\n        this_textarea[0].name = \"survey_\" + row['item_name'];\r\n        this_textarea\r\n          .addClass(row[\"item_name\"] + \"_item row_\" + row[\"row_no\"])\r\n          .addClass(\"response\");\r\n        this_textarea.css(\"width\", \"100%\")\r\n                     .css(\"height\", \"200px\");\r\n    this_html += this_textarea[0].outerHTML;\r\n\r\n  } else if(type == \"radio_horizontal\"){\r\n\r\n    var options = row[\"answers\"].split(\"|\");\r\n    var this_table = $(\"<table>\");\r\n        this_row = this_table[0].insertRow()\r\n    for(var i=0; i<options.length;i++){\r\n      var this_cell = this_row.insertCell();\r\n      var this_div = $(\"<div>\");\r\n          this_div.addClass(\"custom-control\");\r\n          this_div.addClass(\"custom-radio\");\r\n      var this_input = $(\"<input>\");\r\n          this_input[0].type = \"radio\";\r\n          this_input[0].id = row[\"item_name\"] + i;\r\n          this_input[0].name = 'survey_' + row[\"item_name\"];\r\n          this_input.addClass(\"custom-control-input\")\r\n            .addClass(\"response\")\r\n            .addClass(row[\"this_class\"])\r\n            .addClass(row[\"custom-control\"])\r\n            .addClass(row[\"custom-radio\"])\r\n            .addClass(row[\"item_name\"] +'_item')\r\n            .addClass('row_' + row[\"row_no\"]);\r\n      var this_label = $(\"<label>\");\r\n          this_label[0].htmlFor = row[\"item_name\"] + i;\r\n          this_label[0].innerText = options[i];\r\n          this_label.addClass(\"custom-control-label\");\r\n      this_div.append(this_input)\r\n              .append(this_label);\r\n      this_cell.innerHTML = this_div[0].outerHTML;\r\n    }\r\n    this_html += this_table[0].outerHTML;\r\n\r\n  } else if(type == \"radio_vertical\"){\r\n    var options = row[\"answers\"].split(\"|\");\r\n    var values  = row[\"values\"].split(\"|\");\r\n    for(var i=0; i<options.length; i++){\r\n      feedback_string = generate_feedback_string(\r\n        feedback_array, i, feedback_color,row\r\n      );\r\n      var this_div = $(\"<div>\");\r\n          this_div\r\n            .addClass(\"custom-control\")\r\n            .addClass(\"custom-radio\");\r\n      var this_input = $(\"<input>\");\r\n          this_input[0].type  = \"radio\";\r\n          this_input[0].id    = row[\"item_name\"] + i;\r\n          this_input[0].value = options[i];\r\n          this_input[0].name  = 'survey_' + row[\"item_name\"];\r\n          this_input\r\n            .addClass(\"custom-control-input\")\r\n            .addClass(row[\"this_class\"])\r\n            .addClass(\"custom-control\")\r\n            .addClass(\"custom-radio\")\r\n            .addClass(\"response\")\r\n            .addClass(row[\"item_name\"] + \"_item_row_\" + row[\"row_no\"]);\r\n      var this_label = $(\"<label>\");\r\n          this_label[0].htmlFor = row[\"item_name\"]+i;\r\n          this_label.addClass(\"custom-control-label\");\r\n          this_label.html(options[i]);\r\n      this_div\r\n        .append(this_input)\r\n        .append(this_label)\r\n        .append(feedback_string);\r\n      this_html += this_div[0].outerHTML;\r\n    }\r\n\r\n  } else if(type == \"text\"){\r\n    var this_input = $(\"<input>\");\r\n        this_input[0].type=\"text\";\r\n        this_input[0].name=\"survey_\" + row['item_name'];\r\n        this_input\r\n          .addClass(\"form-control\")\r\n          .addClass(row[\"item_name\"] + \"_item row_\" + row[\"row_no\"])\r\n          .addClass(\"response\")\r\n    this_html += this_input[0].outerHTML;\r\n  }\r\n\r\n  switch(type){\r\n    case \"checkbox_vertical\":\r\n    case \"radio_vertical\":\r\n      // do nothing\r\n      break;\r\n    default:\r\n      this_html += generate_feedback_string(\r\n        feedback_array,\r\n        0,\r\n        feedback_color,\r\n        row\r\n      );\r\n      break;\r\n  }\r\n\r\n  return (this_html);\r\n}\r\n\r\nfunction write_survey(this_survey, this_id){\r\n  scoring_object.update_scales(this_survey);\r\n  survey_html = \"<table class='table_break' id='table0'>\";\r\n  this_survey_object={\r\n    content:[],\r\n    shuffle_question:[],\r\n    content_new_order:[],\r\n    shuffled_content:[],\r\n    shuffled_arrays:{},\r\n  }\r\n\r\n  survey_html += \"<tr>\";\r\n  for(i = 0; i < this_survey.length; i++){\r\n    row = this_survey[i];\r\n    row_html = process_question(row,i);\r\n\t\tthis_survey_object.content.push(row_html[0]);\r\n    this_survey_object.shuffle_question.push(row_html[1]);\r\n\t}\r\n\r\n\tunique_shuffles = this_survey_object.shuffle_question.filter((v,i,a)=>a.indexOf(v)==i); //by Camilo Martin on https://stackoverflow.com/questions/1960473/unique-values-in-an-array\r\n\r\n\tfor(var i=0;i<unique_shuffles.length;i++){\r\n    if(typeof(unique_shuffles[i]) !== \"undefined\" &&\r\n      unique_shuffles[i] !== \"none\" &&\r\n      unique_shuffles[i] !== \"\"){\r\n        shuffled_content = this_survey_object.shuffle_question.map(function(element,index){\r\n    \t   if(typeof(element)!== \"undefined\" && element.toLowerCase() !== \"none\" && element.toLowerCase() == unique_shuffles[i]){\r\n  \t       return this_survey_object.content[index];\r\n    \t   }\r\n    \t}).filter(elm => typeof(elm) !== \"undefined\");\r\n    \tnew_order = shuffle(shuffled_content);\r\n    \tthis_survey_object.shuffled_arrays[unique_shuffles[i]]=new_order; // add new array with dynamic name\r\n    }\r\n\t}\r\n\r\n\tfor(var i=0;i<this_survey_object.content.length;i++){\r\n    var this_index = Object.keys(this_survey_object.shuffled_arrays).indexOf(this_survey_object.shuffle_question[i]);\r\n    if(this_index !== -1){\r\n      //take first item off relevant list and delete item\r\n      var this_item = this_survey_object.shuffled_arrays[Object.keys(this_survey_object.shuffled_arrays)[this_index]].shift();\r\n      this_survey_object.content_new_order[i]=this_item;\r\n    } else {\r\n      this_survey_object.content_new_order[i]=this_survey_object.content[i];\r\n    }\r\n\t}\r\n\r\n\tqs_in_order = this_survey_object.content_new_order.join(\"</tr><tr>\");\r\n\tqs_in_order += \"</tr>\";\r\n\r\n\tsurvey_html += qs_in_order;\r\n\tsurvey_html += \"</table>\";\r\n\r\n\t$(\"#\" + this_id).html(survey_html);\r\n\r\n  $(\".response\").on(\"change\", function(){\r\n    response_check(this);\r\n  })\r\n\r\n  $(\"#\" + this_id).show(1000); //scroll to top\r\n\r\n\t$(\".show_tab\").on(\"click\",function(){\r\n    if(this.className.indexOf(\"disabled\") == -1){\r\n      $(\".show_tab\").removeClass(\"active\");\r\n      $(\".survey_page\").hide();\r\n      $(\"#\"+this.id.replace(\"_button\",\"\")).show();\r\n    } else {\r\n      bootbox.alert(\"You have not yet unlocked this tab - maybe try clicking on <b>Proceed</b>?\");\r\n    }\r\n\t});\r\n  $('[data-toggle=\"tooltip\"]').tooltip();\r\n  $(\".custom-checkbox\").prop(\"indeterminate\",true);\r\n}\r\n\r\n/*\r\n* Load survey\r\n*/\r\ncurrent_survey = \"{{survey}}\";\r\nif(typeof(Phase) !== \"undefined\"){\r\n  Phase.set_timer(function(){\r\n    load_survey(current_survey);\r\n  },100);\r\n} else {\r\n  load_survey(current_survey);\r\n}\r\n</script>\r\n",
    "text": "<!--\n/*  Collector (Garcia, Kornell, Kerr, Blake & Haffey)\n    A program for running experiments on the web\n    Copyright 2012-2016 Mikey Garcia & Nate Kornell\n\n\n    This program is free software: you can redistribute it and/or modify\n    it under the terms of the GNU General Public License version 3 as published by\n    the Free Software Foundation.\n\n    This program is distributed in the hope that it will be useful,\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n    GNU General Public License for more details.\n\n    You should have received a copy of the GNU General Public License\n    along with this program.  If not, see <http://www.gnu.org/licenses/>\n \t\t\n\t\tKitten/Cat release (2019-21) author: Dr. Anthony Haffey (team@someopen.solutions)\t\t\n*/\n-->\n{{text}}"
  },
  "mods": {},
  "location": "biagi-haffey/placement/groupwork",
  "storage_scripts": {
    "ocollector.org": "https://ocollector.org/StoreData_Cat_0_ahsd8elnqwhela0w8emzbxvaow.php"
  },
  "procs_csv": {},
  "stims_csv": {}
}